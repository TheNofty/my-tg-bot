<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Splicerr Mini App</title>
    
    <script src="https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.min.js"></script>

    <style>
        :root {
            --bg-color: #0d0d0d;
            --card-color: #1a1a1a;
            --text-color: #ffffff;
            --muted-text: #888888;
            --accent-color: #1e87f0; /* –¶–≤–µ—Ç –∞–∫—Ü–µ–Ω—Ç–∞ */
            --border-color: #2b2b2b;
        }

        body {
            margin: 0;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            min-height: 100vh;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        .page.hidden {
            display: none !important;
        }

        /* === –í–ï–†–•–ù–ò–ô –ë–ê–† –ò –ü–û–ò–°–ö === */
        .topbar {
            display: flex;
            align-items: center;
            padding: 15px 10px;
            background: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            font-weight: bold;
            font-size: 18px;
            color: var(--accent-color);
            margin-right: 15px;
        }

        .search {
            flex-grow: 1;
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--card-color);
            color: var(--text-color);
            outline: none;
        }

        /* === –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ === */
        .page {
            padding: 10px;
            padding-bottom: 90px; /* –û—Ç—Å—Ç—É–ø, —á—Ç–æ–±—ã –Ω–∏–∂–Ω–∏–π –±–∞—Ä –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª –∫–æ–Ω—Ç–µ–Ω—Ç */
        }

        h2 {
            font-size: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        /* === –ö–ê–†–¢–û–ß–ö–ê –ó–í–£–ö–ê (Sound Item) === */
        .sound-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }

        .sound-meta {
            flex-grow: 1;
            min-width: 0;
        }

        .title {
            font-size: 15px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tags {
            font-size: 11px;
            color: var(--muted-text);
            margin-top: 4px;
        }

        .sound-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* === –í–û–õ–ù–û–í–ê–Ø –§–û–†–ú–ê (Wavesurfer.js) === */
        .wave-container-real {
            height: 40px;
            width: 120px; /* –®–∏—Ä–∏–Ω–∞ –≤–æ–ª–Ω—ã */
            cursor: pointer;
            overflow: hidden;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ Play/Download */
        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: none;
            background: var(--card-color);
            color: var(--text-color);
            cursor: pointer;
            font-size: 14px;
            margin-left: 5px; /* –ù–µ–º–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∏–º –∫–Ω–æ–ø–∫–∏ */
        }
        
        .play-btn:active {
            background: var(--accent-color);
        }

        /* === –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ (DOCK) === */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--card-color);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid var(--border-color);
        }

        .nav-btn {
            color: var(--muted-text);
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            padding: 5px 0;
        }

        .nav-btn.active {
            color: var(--accent-color);
            font-weight: 600;
        }

        /* === –ù–ò–ñ–ù–ò–ô –ü–õ–ï–ï–† (Fixed Player) === */
        #player-controls {
            position: fixed;
            bottom: 60px; /* –ù–∞–¥ –Ω–∏–∂–Ω–∏–º –º–µ–Ω—é */
            left: 10px;
            right: 10px;
            background: var(--card-color);
            padding: 10px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            align-items: center;
            gap: 10px;
        }

        #player-controls button {
            background: var(--bg-color);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            color: var(--text-color);
            cursor: pointer;
        }

        #player-info {
            flex-grow: 1;
        }

        #player-title {
            font-size: 14px;
            font-weight: 600;
        }

        #player-tags {
            font-size: 11px;
            color: var(--muted-text);
        }
    </style>
</head>
<body>

    <header class="topbar">
        <div class="logo">Splicerr</div>
        <input class="search" placeholder="Search samples...">
    </header>

    <section id="home" class="page hidden">
        <h2>–ì–ª–∞–≤–Ω–∞—è</h2>
        <p>–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç.</p>
    </section>

    <section id="sounds" class="page">
        <h2>Sounds</h2>

        <div id="sounds-list">
            </div>
    </section>

    <div id="player-controls">
        <div id="player-info">
            <div id="player-title"></div>
            <div id="player-tags"></div>
        </div>
        <button id="player-play-btn">‚ñ∂</button>
    </div>

    <div class="bottom-nav">
        <div class="nav-btn" id="btn-home" onclick="showPage('home')">üè† Home</div>
        <div class="nav-btn active" id="btn-sounds" onclick="showPage('sounds')">üîä Sounds</div>
    </div>


    <script>
        // 1. –ë–ê–ó–ê –ó–í–£–ö–û–í (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ URL –¥–ª—è —Ç–µ—Å—Ç–∞)
        // –í–ê–ñ–ù–û: –∑–∞–º–µ–Ω–∏ —ç—Ç–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤–æ–∏ —Ä–µ–∞–ª—å–Ω—ã–µ MP3/WAV, –ª–µ–∂–∞—â–∏–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ!
        const SAMPLE_DATA = [
            { id: 1, title: "Kick_Boom.wav", tags: "drums, one-shot, kick", time: "0:01", bpm: "--", key: "--", audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
            { id: 2, title: "Dreamy_Loop.wav", tags: "synth, loop, melody, Cmin", time: "0:08", bpm: "120", key: "Cmin", audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
            { id: 3, title: "Pad_FX_Sweep.wav", tags: "fx, riser, sweep", time: "0:04", bpm: "--", key: "--", audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
            { id: 4, title: "Clap_808.wav", tags: "drums, one-shot, clap", time: "0:00", bpm: "--", key: "--", audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" },
        ];

        let activeWaveSurfer = null;
        let currentSoundId = null;
        const playerBtn = document.getElementById('player-play-btn');

        // 2. –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –°–ü–ò–°–ö–ê –ó–í–£–ö–û–í
        function renderSoundList() {
            const soundListContainer = document.getElementById('sounds-list');
            soundListContainer.innerHTML = '';
            
            SAMPLE_DATA.forEach(item => {
                const row = document.createElement('div');
                row.className = 'sound-item';
                
                // –í–ê–ñ–ù–û: –ú—ã —Å–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (DIV) —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID –¥–ª—è –≤–æ–ª–Ω—ã
                const waveId = `wave-${item.id}`;
                
                row.innerHTML = `
                    <div class="sound-meta">
                        <div class="title">${item.title}</div>
                        <div class="tags">${item.tags} ¬∑ ${item.bpm} BPM</div>
                    </div>
                    <div class="sound-details">
                        <div id="${waveId}" class="wave-container-real"></div> 
                        <div class="time">${item.time}</div>
                        
                        <button class="action-btn play-btn" data-id="${item.id}">‚ñ∂</button>
                        
                        <button class="action-btn download-btn" onclick="downloadSound('${item.audioUrl}', '${item.title}')">‚¨áÔ∏è</button>
                    </div>
                `;
                
                soundListContainer.appendChild(row);
                
                // 3. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø WAVESURFER –î–õ–Ø –ö–ê–ñ–î–û–ì–û –ó–í–£–ö–ê
                const ws = WaveSurfer.create({
                    container: `#${waveId}`, // –°—é–¥–∞ —Ä–∏—Å—É–µ–º –≤–æ–ª–Ω—É
                    waveColor: '#444',       // –¶–≤–µ—Ç –≤–æ–ª–Ω—ã (—Å–µ—Ä—ã–π)
                    progressColor: '#1e87f0',// –¶–≤–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Å–∏–Ω–∏–π)
                    barWidth: 4,             // –®–∏—Ä–∏–Ω–∞ "–æ–≤–∞–ª–æ–≤"
                    barGap: 2,               // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É "–æ–≤–∞–ª–∞–º–∏"
                    barRadius: 999,          // –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ ("–æ–≤–∞–ª")
                    height: 40,              // –í—ã—Å–æ—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                    url: item.audioUrl,      // –°—Å—ã–ª–∫–∞ –Ω–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
                    mediaControls: false,    // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–ª–µ–µ—Ä
                });

                // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ Play/Pause –≤ —Å–ø–∏—Å–∫–µ
                row.querySelector('.play-btn').onclick = (e) => {
                    handlePlayPause(ws, item);
                };
                
                // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∫–ª–∏–∫–∞ –Ω–∞ —Å–∞–º–æ–π –≤–æ–ª–Ω–µ (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
                row.querySelector('.wave-container-real').onclick = (e) => {
                    handlePlayPause(ws, item);
                };
            });
        }


        // 4. –§–£–ù–ö–¶–ò–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–õ–ï–ï–†–û–ú 
        function handlePlayPause(newWs, item) {
            // –ö–Ω–æ–ø–∫–∞ –≤ —Å–ø–∏—Å–∫–µ, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å
            const listPlayBtn = document.querySelector(`.play-btn[data-id="${item.id}"]`);

            if (activeWaveSurfer && activeWaveSurfer !== newWs) {
                // –ï—Å–ª–∏ –∏–≥—Ä–∞–µ—Ç –¥—Ä—É–≥–æ–π –∑–≤—É–∫, —Å—Ç–∞–≤–∏–º –µ–≥–æ –Ω–∞ –ø–∞—É–∑—É
                activeWaveSurfer.pause();
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É —É –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∫–Ω–æ–ø–∫–∏ –≤ —Å–ø–∏—Å–∫–µ
                document.querySelector(`.play-btn[data-id="${currentSoundId}"]`).innerText = '‚ñ∂'; 
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º Play/Pause –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∑–≤—É–∫–∞
            newWs.playPause();

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å:
            if (newWs.isPlaying()) {
                listPlayBtn.innerText = '‚è∏';
                playerBtn.innerText = '‚è∏';
                currentSoundId = item.id;
                activeWaveSurfer = newWs;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∏–∂–Ω–∏–π –ø–ª–µ–µ—Ä
                document.getElementById('player-title').innerText = item.title;
                document.getElementById('player-tags').innerText = item.tags;
                document.getElementById('player-controls').style.display = 'flex';
                
            } else {
                listPlayBtn.innerText = '‚ñ∂';
                playerBtn.innerText = '‚ñ∂';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É, –∫–æ–≥–¥–∞ –∞—É–¥–∏–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è
            newWs.on('finish', () => {
                listPlayBtn.innerText = '‚ñ∂';
                playerBtn.innerText = '‚ñ∂';
            });
        }
        
        // 5. –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –°–ö–ê–ß–ò–í–ê–ù–ò–ï
        function downloadSound(url, filename) {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
            const link = document.createElement('a');
            
            // –£–∫–∞–∑—ã–≤–∞–µ–º URL —Ñ–∞–π–ª–∞
            link.href = url;
            
            // –£–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º —Ñ–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω
            link.download = filename; 
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∫–ª–∏–∫–∞–µ–º –ø–æ –Ω–µ–π –∏ —Å—Ä–∞–∑—É —É–¥–∞–ª—è–µ–º
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ Telegram WebApp)
            try {
                 Telegram.WebApp.showPopup({
                     message: `–ù–∞—á–∞–ª–∞—Å—å –∑–∞–≥—Ä—É–∑–∫–∞: ${filename}`,
                     title: '–°–∫–∞—á–∏–≤–∞–Ω–∏–µ',
                     buttons: [{id: 'ok', type: 'default', text: 'OK'}],
                 });
            } catch (e) {
                 console.log('–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å.');
            }
        }


        // –ö–õ–ò–ö –ù–ê –ö–ù–û–ü–ö–£ –í –ù–ò–ñ–ù–ï–ú –ü–õ–ï–ï–†–ï
        playerBtn.onclick = () => {
            if (activeWaveSurfer) {
                activeWaveSurfer.playPause();
                const item = SAMPLE_DATA.find(i => i.id === currentSoundId);
                handlePlayPause(activeWaveSurfer, item); // –û–±–Ω–æ–≤–∏—Ç –∏–∫–æ–Ω–∫–∏ –≤ —Å–ø–∏—Å–∫–µ –∏ –≤–Ω–∏–∑—É
            }
        };


        // 6. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø (–ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ)
        document.addEventListener('DOMContentLoaded', () => {
            // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            try {
                // –ï—Å–ª–∏ —Ç—ã –Ω–µ –≤ –¢–µ–ª–µ–≥—Ä–∞–º–µ, —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –≤—ã–¥–∞–¥—É—Ç –æ—à–∏–±–∫—É, –Ω–æ –∫–æ–¥ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
            } catch (e) {
                console.warn('Not in Telegram WebApp environment');
            }

            // 2. –†–µ–Ω–¥–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫ –∑–≤—É–∫–æ–≤
            renderSoundList();
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
        function showPage(name) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(name).classList.remove('hidden');

            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${name}`).classList.add('active');
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Sounds –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        showPage('sounds');
    </script>

</body>
</html>